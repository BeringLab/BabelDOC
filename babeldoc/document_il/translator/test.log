[INFO][2025-06-24 02:03:53,965][server][MainThread|137845006715776] Constructed server with NATS_URL = nats://nats:4222, starting...
[INFO][2025-06-24 02:03:53,965][translator][MainThread|137845006715776] Subscription command added; Subject 'bering_workqueue.MtDocumentJob.PDFJobPlaced'
[INFO][2025-06-24 02:03:53,965][translator][MainThread|137845006715776] Subscription command added; Subject 'bering_workqueue.mt_worker.mt_job.MtJobPdfSegmentProcessed'
[WARNING][2025-06-24 02:03:53,966][translator][MainThread|137845006715776] Subject 'bering_workqueue.MtDocumentJob.PDFJobPlaced' is not subscribed yet, waiting...
[INFO][2025-06-24 02:03:53,966][translator][MainThread|137845006715776] Subscription command added; Subject 'bering_workqueue.mt_worker.mt_job.MtJobPdfSegmentProcessed'
[INFO][2025-06-24 02:03:53,971][translator][MainThread|137845006715776] Connected to NATS server at nats://nats:4222 in thread 137845006715776
[INFO][2025-06-24 02:03:53,971][translator][MainThread|137845006715776] Starting endless subscription loop..
[INFO][2025-06-24 02:03:53,971][translator][MainThread|137845006715776] Subscribed subject 'bering_workqueue.MtDocumentJob.PDFJobPlaced'
[INFO][2025-06-24 02:03:53,971][translator][MainThread|137845006715776] Subscribed subject 'bering_workqueue.mt_worker.mt_job.MtJobPdfSegmentProcessed'
[INFO][2025-06-24 02:03:53,971][translator][MainThread|137845006715776] Starting endless publishing loop..
[INFO][2025-06-24 02:11:19,523][server][MainThread|137845006715776] Received message: {'input_path': '1/7343098358153744385.pdf', 'job_id': '7343098366357839872', 'source_language': 'en', 'target_language': 'ko', 'translation_domain': 'legal'}
[INFO][2025-06-24 02:11:19,524][server][MainThread|137845006715776] Downloading file from test-bering-bucket/1/7343098358153744385.pdf..
[INFO][2025-06-24 02:11:19,803][pdf2zh_adapter][MainThread|137845006715776] Saving PDF content to /tmp/tmp_pdf2zh_cWWT0e1EnM3mv59990GednZDuFfh7Y.pdf
[INFO][2025-06-24 02:11:19,809][server][MainThread|137845006715776] Handling PDF translation with PDF2ZHAdapter... (1/7343098358153744385.pdf)
[INFO][2025-06-24 02:11:19,820][pdf2zh_adapter][MainThread|137845006715776] Initializing BeringTranslator with lang_in=en, lang_out=ko, domain=legal
[INFO][2025-06-24 02:11:19,820][doclayout][MainThread|137845006715776] Loading ONNX model...
[INFO][2025-06-24 02:11:19,834][assets][Thread-1 (_wrapper)|137842839590592] doclayout onnx model not found or corrupted, downloading...
[INFO][2025-06-24 02:11:23,179][assets][Thread-1 (_wrapper)|137842839590592] Download doclayout onnx model from huggingface success
[INFO][2025-06-24 02:11:23,274][doclayout][MainThread|137845006715776] Available Provider: CPUExecutionProvider
[INFO][2025-06-24 02:11:23,964][assets][Thread-3 (_wrapper)|137842445510336] table detection rapidocr model not found or corrupted, downloading...
[INFO][2025-06-24 02:11:24,961][assets][Thread-3 (_wrapper)|137842445510336] Download table detection rapidocr model from huggingface success
[INFO][2025-06-24 02:11:28,290][high_level][asyncio_0|137842847983296] start to translate: /tmp/tmp_pdf2zh_cWWT0e1EnM3mv59990GednZDuFfh7Y.pdf
[INFO][2025-06-24 02:11:29,563][assets][Thread-7 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/SourceHanSerifKR-Bold.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:30,845][assets][Thread-9 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/SourceHanSerifKR-Regular.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:32,698][assets][Thread-11 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/SourceHanSansKR-Bold.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:33,595][assets][Thread-13 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/SourceHanSansKR-Regular.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:34,597][assets][Thread-15 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/SourceHanSerifCN-Bold.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:36,583][assets][Thread-17 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/SourceHanSerifCN-Regular.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:38,427][assets][Thread-19 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/SourceHanSansCN-Bold.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:40,022][assets][Thread-21 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/SourceHanSerifTW-Bold.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:41,443][assets][Thread-23 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/SourceHanSerifTW-Regular.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:42,868][assets][Thread-25 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/SourceHanSansTW-Bold.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:44,008][assets][Thread-27 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/SourceHanSansTW-Regular.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:45,439][assets][Thread-29 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/SourceHanSerifHK-Bold.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:46,669][assets][Thread-31 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/SourceHanSerifHK-Regular.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:47,938][assets][Thread-33 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/SourceHanSansHK-Bold.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:48,947][assets][Thread-35 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/SourceHanSansHK-Regular.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:50,085][assets][Thread-37 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/SourceHanSerifJP-Bold.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:51,312][assets][Thread-39 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/SourceHanSerifJP-Regular.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:52,483][assets][Thread-41 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/SourceHanSansJP-Bold.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:53,502][assets][Thread-43 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/SourceHanSansJP-Regular.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:54,518][assets][Thread-45 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/NotoSerif-Regular.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:54,979][assets][Thread-47 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/NotoSerif-Bold.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:55,424][assets][Thread-49 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/NotoSans-Regular.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:56,019][assets][Thread-51 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/NotoSans-Bold.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:56,604][assets][Thread-53 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/MaruBuri-Regular.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:57,325][assets][Thread-55 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/LXGWWenKaiGB-Regular.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:11:59,548][assets][Thread-57 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/LXGWWenKaiTC-Regular.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:12:01,125][assets][Thread-59 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/KleeOne-Regular.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:12:02,522][assets][Thread-61 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/NotoSans-Italic.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:12:03,097][assets][Thread-63 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/NotoSans-BoldItalic.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:12:03,620][assets][Thread-65 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/NotoSerif-Italic.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:12:04,164][assets][Thread-67 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/NotoSerif-BoldItalic.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:12:04,689][assets][Thread-69 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/GoNotoKurrent-Regular.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:12:06,518][assets][Thread-71 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/GoNotoKurrent-Bold.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:12:08,349][assets][Thread-73 (_wrapper)|137839316559552] Font /root/.cache/babeldoc/fonts/SourceHanSansCN-Regular.ttf not found or corrupted, downloading...
[INFO][2025-06-24 02:12:14,212][il_translator][asyncio_0|137842847983296] Found title paragraph: A Simple PDF File
[INFO][2025-06-24 02:12:14,214][il_translator][asyncio_0|137842847983296] Found first title paragraph: A Simple PDF File
[INFO][2025-06-24 02:12:14,232][translator][ThreadPoolExecutor-3_0|137839316559552] translate: A Simple PDF File
[INFO][2025-06-24 02:12:14,232][translator][ThreadPoolExecutor-3_0|137839316559552] Publish command added for subject 'bering_workqueue.MtPdfJob.MtPdfJobCreated'
[INFO][2025-06-24 02:12:14,355][translator][MainThread|137845006715776] Published message to subject 'bering_workqueue.MtPdfJob.MtPdfJobCreated'
[INFO][2025-06-24 02:12:15,232][translator][ThreadPoolExecutor-3_1|137839308166848] translate: This is a small demonstration .pdf file -
[INFO][2025-06-24 02:12:15,232][translator][ThreadPoolExecutor-3_1|137839308166848] Publish command added for subject 'bering_workqueue.MtPdfJob.MtPdfJobCreated'
[INFO][2025-06-24 02:12:15,356][translator][MainThread|137845006715776] Published message to subject 'bering_workqueue.MtPdfJob.MtPdfJobCreated'
[INFO][2025-06-24 02:12:16,358][translator][MainThread|137845006715776] Received PDFSegmentProcessed: {'job_id': 123, 'segment_id': 1750731134232, 'target_language': 'ko', 'payload': {'main_text': ['간단한', 'PDF', '파일']}}
[INFO][2025-06-24 02:12:17,264][translator][ThreadPoolExecutor-3_0|137839316559552] translate: ...continued from page 1. Yet more text. And more text. And more text. And more text. And more text. And more text. And more text. And more text. Oh, how boring typing this stuff. But not as boring as watching paint dry. And more text. And more text. And more text. And more text. Boring.  More, a little more text. The end, and just as well.
[INFO][2025-06-24 02:12:17,265][translator][ThreadPoolExecutor-3_0|137839316559552] Publish command added for subject 'bering_workqueue.MtPdfJob.MtPdfJobCreated'
[INFO][2025-06-24 02:12:17,359][translator][MainThread|137845006715776] Published message to subject 'bering_workqueue.MtPdfJob.MtPdfJobCreated'
[INFO][2025-06-24 02:12:19,362][translator][MainThread|137845006715776] Received PDFSegmentProcessed: {'job_id': 123, 'segment_id': 1750731135232, 'target_language': 'ko', 'payload': {'main_text': ['이것은', '작은', '시연용', '.pdf', '파일입니다', '-']}}
[INFO][2025-06-24 02:12:20,263][translator][ThreadPoolExecutor-3_1|137839308166848] translate: And more text. And more text. And more text. And more text. And more text. And more text. Boring, zzzzz. And more text. And more text. And more text. And more text. And more text. And more text. And more text. And more text. And more text.
[INFO][2025-06-24 02:12:20,264][translator][ThreadPoolExecutor-3_1|137839308166848] Publish command added for subject 'bering_workqueue.MtPdfJob.MtPdfJobCreated'
[INFO][2025-06-24 02:12:20,364][translator][MainThread|137845006715776] Published message to subject 'bering_workqueue.MtPdfJob.MtPdfJobCreated'
[INFO][2025-06-24 02:12:21,366][translator][MainThread|137845006715776] Received PDFSegmentProcessed: {'job_id': 123, 'segment_id': 1750731137265, 'target_language': 'ko', 'payload': {'main_text': ['...1페이지부터', '계속.', '더', '많은', '텍스트.', '더', '많은', '텍스트.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '오,', '이런', '걸', '타이핑하는', '게', '얼마나', '지루한지.', '하지만', '페인트가', '마르는', '것을', '보는', '것만큼', '지루하지는', '않다.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '지루하다.', '더,', '조금', '더', '텍스트.', '끝,', '그리고', '그만큼', '좋다.']}}
[INFO][2025-06-24 02:12:22,295][translator][ThreadPoolExecutor-3_1|137839308166848] translate: And more text. And more text. And more text. And more text. And more text. And more text. And more text. Even more. Continued on page 2 ...
[INFO][2025-06-24 02:12:22,295][translator][ThreadPoolExecutor-3_1|137839308166848] Publish command added for subject 'bering_workqueue.MtPdfJob.MtPdfJobCreated'
[INFO][2025-06-24 02:12:22,367][translator][MainThread|137845006715776] Published message to subject 'bering_workqueue.MtPdfJob.MtPdfJobCreated'
[INFO][2025-06-24 02:12:24,371][translator][MainThread|137845006715776] Received PDFSegmentProcessed: {'job_id': 123, 'segment_id': 1750731140263, 'target_language': 'ko', 'payload': {'main_text': ['그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '지루하죠.', '텍스트도', '더', '늘어나죠.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.']}}
[INFO][2025-06-24 02:12:25,298][translator][ThreadPoolExecutor-3_0|137839316559552] translate: just for use in the Virtual Mechanics tutorials. More text. And more text. And more text. And more text. And more text.
[INFO][2025-06-24 02:12:25,298][translator][ThreadPoolExecutor-3_0|137839316559552] Publish command added for subject 'bering_workqueue.MtPdfJob.MtPdfJobCreated'
[INFO][2025-06-24 02:12:25,372][translator][MainThread|137845006715776] Received PDFSegmentProcessed: {'job_id': 123, 'segment_id': 1750731142295, 'target_language': 'ko', 'payload': {'main_text': ['그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '텍스트.', '더욱', '더.', '2쪽에서', '계속', '...']}}
[INFO][2025-06-24 02:12:25,373][translator][MainThread|137845006715776] Published message to subject 'bering_workqueue.MtPdfJob.MtPdfJobCreated'
[INFO][2025-06-24 02:12:26,326][translator][ThreadPoolExecutor-3_1|137839308166848] translate: Simple PDF File 2
[INFO][2025-06-24 02:12:26,326][translator][ThreadPoolExecutor-3_1|137839308166848] Publish command added for subject 'bering_workqueue.MtPdfJob.MtPdfJobCreated'
[INFO][2025-06-24 02:12:26,373][translator][MainThread|137845006715776] Published message to subject 'bering_workqueue.MtPdfJob.MtPdfJobCreated'
[INFO][2025-06-24 02:12:27,375][translator][MainThread|137845006715776] Received PDFSegmentProcessed: {'job_id': 123, 'segment_id': 1750731145298, 'target_language': 'ko', 'payload': {'main_text': ['가상역학', '튜토리얼에서만', '사용할', '수', '있습니다.', '더', '많은', '텍스트.', '그리고', '더', '많은', '텍스트.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '문구.', '그리고', '더', '많은', '텍스트.']}}
[INFO][2025-06-24 02:12:29,377][translator][MainThread|137845006715776] Received PDFSegmentProcessed: {'job_id': 123, 'segment_id': 1750731146326, 'target_language': 'ko', 'payload': {'main_text': ['간단한', 'PDF', '파일', '2']}}
[INFO][2025-06-24 02:12:34,138][pdf_creater][asyncio_0|137842847983296] Font subsetting completed successfully
[INFO][2025-06-24 02:12:34,725][pdf_creater][asyncio_0|137842847983296] PDF save with clean=True completed successfully
[INFO][2025-06-24 02:12:34,772][high_level][asyncio_0|137842847983296] Peak memory usage: 3323.73 MB
[INFO][2025-06-24 02:12:34,772][high_level][asyncio_0|137842847983296] finish translate: /tmp/tmp_pdf2zh_cWWT0e1EnM3mv59990GednZDuFfh7Y.pdf, cost: 66.48165273666382 s
[INFO][2025-06-24 02:12:34,772][pdf2zh_adapter][MainThread|137845006715776] Translation completed: Translation results:
	Original PDF: /tmp/tmp_pdf2zh_cWWT0e1EnM3mv59990GednZDuFfh7Y.pdf
	Total time: 66.48 seconds
	Monolingual PDF: tmp_pdf2zh_cWWT0e1EnM3mv59990GednZDuFfh7Y.no_watermark.ko.mono.pdf
	Peak memory usage: 3323.7265625 MB
[INFO][2025-06-24 02:12:34,787][translation_config][asyncio_0|137842847983296] cleanup temp files: /tmp/tmp40pk7v_g
translate                                              ━━━━━ 100/… 0:01:… 0:00:…
Parse PDF and Create Intermediate Representation (1/1) ━━━━━ 2/2   0:00:… 0:00:…
DetectScannedFile (1/1)                                ━━━━━ 2/2   0:00:… 0:00:…
Parse Page Layout (1/1)                                ━━━━━ 2/2   0:00:… 0:00:…
Parse Table (1/1)                                      ━━━━━ 0/0   0:00:… 0:00:…
Parse Paragraphs (1/1)                                 ━━━━━ 2/2   0:00:… 0:00:…
Parse Formulas and Styles (1/1)                        ━━━━━ 2/2   0:00:… 0:00:…
Translate Paragraphs (1/1)                             ━━━━━ 7/7   0:00:… 0:00:…
Typesetting (1/1)                                      ━━━━━ 2/2   0:00:… 0:00:…
Add Fonts (1/1)                                        ━━━━━ 14/14 0:00:… 0:00:…
Generate drawing instructions (1/1)                    ━━━━━ 2/2   0:00:… 0:00:…
Subset font (1/1)                                      ━━━━━ 1/1   0:00:… 0:00:…
[INFO][2025-06-24 02:12:34,797][server][MainThread|137845006715776] Uploading translated file from test-bering-bucket/./tmp_pdf2zh_cWWT0e1EnM3mv59990GednZDuFfh7Y.no_watermark.ko.mono.pdf to test-bering-bucket/1/7343098358153744385_translated.pdf
Save PDF (1/1)                                         ━━━━━ 2/2   0:00:… 0:00:…
[INFO][2025-06-24 02:12:34,895][server][S3Upload_0|137842001053376] File uploaded to test-bering-bucket/1/7343098358153744385_translated.pdf
[INFO][2025-06-24 02:12:34,896][server][MainThread|137845006715776] Translation completed, job_id = 7343098366357839872, old S3 object = 1/7343098358153744385.pdf, new S3 object = 1/7343098358153744385_translated.pdf; Publishing PDFJobDone..
[INFO][2025-06-24 02:12:34,896][translator][MainThread|137845006715776] Publish command added for subject 'bering_workqueue.MtDocumentJob.PDFJobDone'
[INFO][2025-06-24 02:12:35,420][translator][MainThread|137845006715776] Published message to subject 'bering_workqueue.MtDocumentJob.PDFJobDone'